datasource db {
  provider = "sqlite"
}

generator kysely {
  provider  = "prisma-kysely"
  output    = "../../src/database"
}

model Source {
  id          String @id
  name        String
  type        String
  description String
  enabled     Boolean
  config      Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workflow    Workflow @relation(fields: [workflowId], references: [id])
  workflowId  String

  records Record[]

  @@map("source")
}

model Report {
  id          String @id
  name        String
  type        String
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workflow    Workflow @relation(fields: [workflowId], references: [id])
  workflowId  String

  @@map("report")
}

model Record {
  id          String @id
  summary     String
  data        Json
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  source      Source @relation(fields: [sourceId], references: [id])
  sourceId    String

  workflow    Workflow @relation(fields: [workflowId], references: [id])
  workflowId  String
  
  @@map("record")
}

model Workflow {
  id          String @id
  name        String
  sourceId    String

  reports     Report[]
  records     Record[]
  sources     Source[]

  @@map("workflow")
}